{"version":3,"sources":["../../directive/zoom.directive.ts"],"names":[],"mappings":"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","file":"zoom.directive.js","sourceRoot":"","sourcesContent":["import {Directive, ElementRef, HostListener, Input, OnChanges, OnInit, Renderer2} from '@angular/core';\n\n\nexport class ZoomDirective implements OnInit, OnChanges {\n\n  private zoomStep: number;\n  private pinchStep: number;\n  private currentZoom: number;\n  private zoomTarget: any;\n  private zoomPoint: Point; // Position of the mouse on the start of the wheel event.\n  private previousZoom: number;\n\n  private zoomPointLocked: boolean;\n  private zoomPointLockTimeout: any;\n  private currentDeviation: Point;\n\n\n  minZoom: number;\n  maxZoom: number;\n   zoomTargetId: string;\n\n   onWheel(event:any) {\n    if (event.ctrlKey) {\n      event.preventDefault();\n      const ratios = this.getContainerRatios();\n      this.zoomPoint = {x: event.x, y: event.y} ;\n      this.zoomIntoContainer(this.zoomPoint, ratios, (event.deltaY < 0 ) ? this.zoomStep : -this.zoomStep);\n    }\n  }\n   onTouch(event:any) {\n    event.preventDefault();\n    const ratios = this.getContainerRatios();\n    this.zoomPoint = {x: event.center.x, y: event.center.y} ;\n    this.zoomIntoContainer(this.zoomPoint, ratios, this.zoomStep);\n  }\n   onPinchIn(event:any) {\n    if (event.velocityY === 0) { return; }\n    const ratios = this.getContainerRatios();\n    this.zoomPoint = {x: event.center.x, y: event.center.y};\n    this.zoomIntoContainer(this.zoomPoint, ratios, -this.pinchStep);\n  }\n   onPinchOut(event:any) {\n    if (event.velocityY === 0) { return; }\n    const ratios = this.getContainerRatios();\n    this.zoomPoint = {x: event.center.x, y: event.center.y};\n    this.zoomIntoContainer(this.zoomPoint, ratios, this.pinchStep);\n  }\n\n  constructor(private render: Renderer2, private elRef: ElementRef) {\n    this.zoomStep = 0.1;\n    this.pinchStep = 0.05;\n    this.currentZoom = 1;\n    this.previousZoom = 0;\n    this.minZoom = 1;\n    this.maxZoom = 2;\n    this.zoomTargetId = 'zoomTarget';\n  }\n\n  private getContainerRatios(): any {\n    let ratioX, ratioY;\n    if (this.elRef.nativeElement.scrollWidth > this.elRef.nativeElement.scrollHeight) {\n      ratioX = 1;\n      ratioY = this.elRef.nativeElement.scrollHeight / this.elRef.nativeElement.scrollWidth;\n    }else {\n      ratioX = this.elRef.nativeElement.scrollWidth / this.elRef.nativeElement.scrollHeight;\n      ratioY = 1;\n    }\n    return {x: ratioX, y: ratioY};\n  }\n  private zoomIntoContainer(zoomPoint: Point, ratios: any, zoomStep: number) {\n    const prevDif = {\n      right: this.zoomTarget.getBoundingClientRect().right - this.zoomPoint.x ,\n      bottom: this.zoomTarget.getBoundingClientRect().bottom - this.zoomPoint.y\n    };\n\n    if (!this.setNewZoomLevel(zoomStep)) { return; }\n\n    this.render.setStyle(this.zoomTarget, 'transform', 'scale(' + this.currentZoom + ')');\n    const afterDif = {\n      right: this.zoomTarget.getBoundingClientRect().right - this.zoomPoint.x ,\n      bottom: this.zoomTarget.getBoundingClientRect().bottom - this.zoomPoint.y\n    };\n\n    // Scroll to center\n    const scrollLeft = ((afterDif.right - prevDif.right) / this.maxZoom ); // * ratios.x;\n    const scrollTop = ((afterDif.bottom - prevDif.bottom) / this.maxZoom ); // * ratios.y;\n\n    this.elRef.nativeElement.scrollLeft += scrollLeft + this.getCenterDeviation(this.getTargetCenter(),\n        zoomPoint, this.getContainerRatios(), zoomStep).x;\n    this.elRef.nativeElement.scrollTop += scrollTop + this.getCenterDeviation(this.getTargetCenter(),\n        zoomPoint, this.getContainerRatios(), zoomStep).y;\n  }\n\n  private setNewZoomLevel(zoomStep: number): boolean {\n    this.currentZoom += zoomStep;\n    if (this.currentZoom < this.minZoom) {\n      this.currentZoom = this.minZoom;\n      if (this.previousZoom === this.currentZoom) { return false; }\n    }else if (this.currentZoom > this.maxZoom) {\n      this.currentZoom = this.maxZoom;\n      if (this.previousZoom === this.currentZoom) { return false; }\n\n    }\n\n    this.previousZoom = this.currentZoom;\n\n    return true;\n  }\n  private getTargetCenter(): Point {\n    const rectangle = this.elRef.nativeElement.getBoundingClientRect();\n    return {x: rectangle.left + (rectangle.width / 2) , y: rectangle.top + (rectangle.height / 2) };\n  }\n  private getCenterDeviation(center: Point, zoomPoint: Point, ratio: Point, zoomStep: number): Point {\n    if (this.zoomPointLockTimeout) {\n      clearTimeout(this.zoomPointLockTimeout);\n    }\n    this.zoomPointLockTimeout = setTimeout(() => {\n      this.zoomPointLocked = false;\n    }, 1000);\n    if (!this.zoomPointLocked) {\n      this.zoomPointLocked = true;\n      const stepsToMaxZoom = (this.maxZoom - this.currentZoom) / zoomStep;\n      this.currentDeviation = {x: (zoomPoint.x - center.x) / stepsToMaxZoom , y: (zoomPoint.y - center.y) / stepsToMaxZoom };\n    }\n    return this.currentDeviation;\n\n  }\n\n  ngOnInit() {\n    this.zoomTarget = document.getElementById(this.zoomTargetId);\n  }\n\n  ngOnChanges(changes:any) {\n    if (changes.zoomTargetId ) {\n      this.zoomTarget = document.getElementById(this.zoomTargetId);\n    }\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Directive, args: [{\n  selector: '[toiZoom]'\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: Renderer2, },\n{type: ElementRef, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'minZoom': [{ type: Input, args: ['minZoom', ] },],\n'maxZoom': [{ type: Input, args: ['maxZoom', ] },],\n'zoomTargetId': [{ type: Input, args: ['zoomTargetId', ] },],\n'onWheel': [{ type: HostListener, args: ['wheel', ['$event'], ] },],\n'onTouch': [{ type: HostListener, args: ['tap', ['$event'], ] },],\n'onPinchIn': [{ type: HostListener, args: ['pinchin', ['$event'], ] },],\n'onPinchOut': [{ type: HostListener, args: ['pinchout', ['$event'], ] },],\n};\n}\n\nexport class Point {\n  x: number;\n  y: number;\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}