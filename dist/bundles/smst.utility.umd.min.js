!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core")):"function"==typeof define&&define.amd?define(["exports","@angular/core"],e):e((t.smst=t.smst||{},t.smst.utility={}),t.ng.core)}(this,function(t,e){"use strict";var o,i=function(){function t(){this.event=o.NOEVENT,this.locked=!1}return t.prototype.init=function(t){this.event=t,this.locked=!0},t.prototype.unlock=function(){this.event=o.NOEVENT,this.locked=!1},t.prototype.isLocked=function(t){return this.event===o.NOEVENT&&(this.event=t),this.locked&&this.event!==t},t}();!function(t){t[t.NOEVENT=0]="NOEVENT",t[t.PINCH=1]="PINCH",t[t.PAN=2]="PAN",t[t.WHEEL=3]="WHEEL",t[t.TAP=4]="TAP",t[t.EXTERNAL=5]="EXTERNAL"}(o||(o={}));var n=function(){function t(t,o){this.render=t,this.elRef=o,this.zoomStep=.1,this.pinchStep=.03,this.currentZoom||(this.currentZoom=1),this.previousZoom=0,this.minZoom=1,this.maxZoom=2,this.zoomTargetId="zoomTarget",this.eventLock=new i,this.currentZoomChange=new e.EventEmitter,this.enableTabZoom=!1,this.disableZoom=!1}return t.prototype.onWheel=function(t){if(!this.disableZoom&&!this.eventLock.isLocked(o.WHEEL)&&t.ctrlKey){t.preventDefault(),this.eventLock.init(o.WHEEL);var e=this.getContainerRatios();this.zoomPoint={x:t.x,y:t.y},this.zoomIntoContainer(t.deltaY<0?this.zoomPoint:this.getTargetCenter(),e,t.deltaY<0?this.zoomStep:-this.zoomStep),this.resetEventLockTimout()}},t.prototype.onTouch=function(t){if(!this.disableZoom&&this.enableTabZoom){t.preventDefault();var e=this.getContainerRatios();this.zoomPoint={x:t.center.x,y:t.center.y},this.zoomIntoContainer(this.zoomPoint,e,this.zoomStep),this.resetEventLockTimout()}},t.prototype.onPinchIn=function(t){if(!this.disableZoom&&0!==t.velocityY&&!this.eventLock.isLocked(o.PINCH)){var e=this.getContainerRatios();this.zoomPoint={x:t.center.x,y:t.center.y},this.zoomIntoContainer(this.zoomPoint,e,-this.pinchStep)}},t.prototype.onPinchOut=function(t){if(!this.disableZoom&&0!==t.velocityY&&!this.eventLock.isLocked(o.PINCH)){var e=this.getContainerRatios();this.zoomPoint={x:t.center.x,y:t.center.y},this.zoomIntoContainer(this.getTargetCenter(),e,this.pinchStep)}},t.prototype.onTouchStart=function(t){this.disableZoom||(t.touches.length>1?this.eventLock.isLocked(o.PAN)||(this.eventLock.unlock(),this.eventLock.init(o.PINCH)):this.eventLock.isLocked(o.PAN)||(this.eventLock.init(o.PAN),this.zoomPoint={x:t.touches[0].clientX,y:t.touches[0].clientY}))},t.prototype.onTouchMove=function(t){if(!this.disableZoom&&!(this.zoomPoint.x<0||this.eventLock.isLocked(o.PAN))){var e={x:t.touches[0].clientX,y:t.touches[0].clientY};this.scroll("x",this.zoomPoint.x-e.x),this.scroll("y",this.zoomPoint.y-e.y),this.zoomPoint=e}},t.prototype.onTouchEnd=function(t){this.eventLock.unlock(),this.zoomPoint={x:-1,y:-1}},t.prototype.getContainerRatios=function(){var t,e;return this.zoomTarget.getBoundingClientRect().height>this.zoomTarget.getBoundingClientRect().width?(t=1,e=this.zoomTarget.getBoundingClientRect().width/this.zoomTarget.getBoundingClientRect().height):(t=this.zoomTarget.getBoundingClientRect().height/this.zoomTarget.getBoundingClientRect().width,e=1),{x:t,y:e}},t.prototype.zoomIntoContainer=function(t,e,i,n){if(this.zoomTarget.firstElementChild){var r={right:this.zoomTarget.firstElementChild.getBoundingClientRect().right-t.x,bottom:this.zoomTarget.firstElementChild.getBoundingClientRect().bottom-t.y};if(this.setNewZoomLevel(i,n||!1)){this.render.setStyle(this.zoomTarget.firstElementChild,"transform-origin","0 0"),this.render.setStyle(this.zoomTarget.firstElementChild,"transform","scale("+this.currentZoom+")");var s={right:this.zoomTarget.firstElementChild.getBoundingClientRect().right-t.x,bottom:this.zoomTarget.firstElementChild.getBoundingClientRect().bottom-t.y},h=(this.elRef.nativeElement.scrollLeft+this.getScrollHandleSize("x"))/this.elRef.nativeElement.scrollWidth,c=(this.elRef.nativeElement.scrollTop+this.getScrollHandleSize("y"))/this.elRef.nativeElement.scrollHeight,m=i<0?0:this.eventLock.isLocked(o.PINCH)&&this.eventLock.isLocked(o.EXTERNAL)?this.getScrollHandleSize("x")/2:0,a=i<0?0:this.eventLock.isLocked(o.PINCH)&&this.eventLock.isLocked(o.EXTERNAL)?this.getScrollHandleSize("y")/2:0,l=(s.right-r.right)*h+m,u=(s.bottom-r.bottom)*c+a;this.elRef.nativeElement.scrollLeft+=l+this.getCenterDeviation(this.getTargetCenter(),t,e,i).x,this.elRef.nativeElement.scrollTop+=u+this.getCenterDeviation(this.getTargetCenter(),t,e,i).y,this.currentZoomChange.emit(this.currentZoom)}}},t.prototype.getScrollHandleSize=function(t){return"x"===t?this.elRef.nativeElement.clientWidth/this.zoomTarget.firstElementChild.getBoundingClientRect().width*(this.elRef.nativeElement.clientWidth-20)*.7:this.elRef.nativeElement.clientHeight/this.zoomTarget.firstElementChild.getBoundingClientRect().height*(this.elRef.nativeElement.clientHeight-20)*.7},t.prototype.setNewZoomLevel=function(t,e){if(this.currentZoom=e?this.currentZoom:this.currentZoom+=t,this.currentZoom<this.minZoom){if(this.currentZoom=this.minZoom,this.previousZoom===this.currentZoom)return!1}else if(this.currentZoom>this.maxZoom&&(this.currentZoom=this.maxZoom,this.previousZoom===this.currentZoom))return!1;return this.previousZoom=this.currentZoom,!0},t.prototype.getTargetCenter=function(){var t=this.elRef.nativeElement.getBoundingClientRect();return{x:t.left+t.width/2,y:t.top+t.height/2}},t.prototype.getCenterDeviation=function(t,e,i,n){var r=this;if(this.eventLock.isLocked(o.WHEEL))return{x:0,y:0};if(this.zoomPointLockTimeout&&clearTimeout(this.zoomPointLockTimeout),this.zoomPointLockTimeout=setTimeout(function(){r.zoomPointLocked=!1},500),!this.zoomPointLocked){this.zoomPointLocked=!0;var s=(this.maxZoom-this.currentZoom)/n;s=0===s?1:s,this.currentDeviation={x:(e.x-t.x)/s,y:(e.y-t.y)/s}}return this.currentDeviation},t.prototype.scroll=function(t,e){switch(t){case"y":this.elRef.nativeElement.scrollTop+=e;break;case"x":this.elRef.nativeElement.scrollLeft+=e}},t.prototype.defineZoomTarget=function(){this.zoomTarget=document.getElementById(this.zoomTargetId),this.zoomTarget||console.error("SmStUtilityModule - ZoomDirective: ","zoomTarget could not be initiated. ","zoomTargetId = ",this.zoomTargetId)},t.prototype.resetEventLockTimout=function(){var t=this;this.eventLockResetTimout&&clearTimeout(this.eventLockResetTimout),this.eventLockResetTimout=setTimeout(function(){t.eventLock.unlock()},500)},t.prototype.ngOnInit=function(){this.zoomTarget=document.getElementById(this.zoomTargetId)},t.prototype.ngOnChanges=function(t){t.zoomTargetId&&this.defineZoomTarget(),t.currentZoom&&(this.zoomTarget||this.defineZoomTarget(),this.eventLock.isLocked(o.EXTERNAL)||(this.eventLock.init(o.EXTERNAL),this.zoomIntoContainer(this.getTargetCenter(),this.getContainerRatios(),t.currentZoom.currentValue-(t.currentZoom.previousValue||1),!0),this.resetEventLockTimout())),t.disableZoom&&this.eventLock.unlock()},t.decorators=[{type:e.Directive,args:[{selector:"[smstZoom]"}]}],t.ctorParameters=function(){return[{type:e.Renderer2},{type:e.ElementRef}]},t.propDecorators={minZoom:[{type:e.Input,args:["minZoom"]}],maxZoom:[{type:e.Input,args:["maxZoom"]}],zoomTargetId:[{type:e.Input,args:["zoomTargetId"]}],currentZoom:[{type:e.Input,args:["currentZoom"]}],enableTabZoom:[{type:e.Input,args:["enableTabZoom"]}],disableZoom:[{type:e.Input,args:["disableZoom"]}],currentZoomChange:[{type:e.Output,args:["currentZoomChange"]}],onWheel:[{type:e.HostListener,args:["wheel",["$event"]]}],onTouch:[{type:e.HostListener,args:["tap",["$event"]]}],onPinchIn:[{type:e.HostListener,args:["pinchin",["$event"]]}],onPinchOut:[{type:e.HostListener,args:["pinchout",["$event"]]}],onTouchStart:[{type:e.HostListener,args:["touchstart",["$event"]]}],onTouchMove:[{type:e.HostListener,args:["touchmove",["$event"]]}],onTouchEnd:[{type:e.HostListener,args:["touchend",["$event"]]}]},t}(),r=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:[n],imports:[],providers:[],bootstrap:[],exports:[n]}]}],t.ctorParameters=function(){return[]},t}();t.SmStUtilityModule=r,t.SmStZoomDirective=n,Object.defineProperty(t,"__esModule",{value:!0})});